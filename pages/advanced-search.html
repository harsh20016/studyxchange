<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Search - StudyXchange</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Range Slider CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.6.0/nouislider.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/responsive.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <div class="container">
                <a class="navbar-brand" href="../index.html">
                    <span class="brand-name">StudyXchange</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="search-container mx-auto">
                        <div class="input-group">
                            <input type="text" id="searchInput" class="form-control" placeholder="Search study materials...">
                            <button class="btn btn-primary" type="button" id="searchButton">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="login.html">
                                <i class="fas fa-user"></i> Login
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="post-ad.html">
                                <i class="fas fa-plus-circle"></i> Post Ad
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="profile.html">
                                <i class="fas fa-user-circle"></i> My Account
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Breadcrumb Section -->
    <section class="breadcrumb-section">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Advanced Search</li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Advanced Search Section -->
    <section class="advanced-search-section py-4">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="section-header mb-4">
                        <h2 class="mb-2">Advanced Search</h2>
                        <p class="text-muted">Find exactly what you're looking for with our powerful search tools</p>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <!-- Search Filters Panel -->
                    <div class="filter-box">
                        <h4 class="mb-3">Search Filters</h4>
                        
                        <!-- Search Keywords -->
                        <div class="filter-group">
                            <h5>Keywords</h5>
                            <div class="mb-3">
                                <input type="text" class="form-control" id="keywordSearch" placeholder="Search by keywords...">
                            </div>
                        </div>
                        
                        <!-- Category Filter -->
                        <div class="filter-group">
                            <h5>Category</h5>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-category" type="checkbox" value="textbooks" id="categoryTextbooks" checked>
                                <label class="form-check-label" for="categoryTextbooks">
                                    <i class="fas fa-book me-1 text-primary"></i> Textbooks
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-category" type="checkbox" value="notes" id="categoryNotes" checked>
                                <label class="form-check-label" for="categoryNotes">
                                    <i class="fas fa-sticky-note me-1 text-primary"></i> Notes
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-category" type="checkbox" value="electronics" id="categoryElectronics" checked>
                                <label class="form-check-label" for="categoryElectronics">
                                    <i class="fas fa-calculator me-1 text-primary"></i> Electronics
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-category" type="checkbox" value="stationery" id="categoryStationery" checked>
                                <label class="form-check-label" for="categoryStationery">
                                    <i class="fas fa-pencil-alt me-1 text-primary"></i> Stationery
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-category" type="checkbox" value="equipment" id="categoryEquipment" checked>
                                <label class="form-check-label" for="categoryEquipment">
                                    <i class="fas fa-microscope me-1 text-primary"></i> Equipment
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-category" type="checkbox" value="courses" id="categoryCourses" checked>
                                <label class="form-check-label" for="categoryCourses">
                                    <i class="fas fa-graduation-cap me-1 text-primary"></i> Course Materials
                                </label>
                            </div>
                        </div>
                        
                        <!-- Subject Filter -->
                        <div class="filter-group">
                            <h5>Subject</h5>
                            <div class="mb-3">
                                <select class="form-select" id="subjectFilter">
                                    <option value="all">All Subjects</option>
                                    <option value="mathematics">Mathematics</option>
                                    <option value="physics">Physics</option>
                                    <option value="chemistry">Chemistry</option>
                                    <option value="biology">Biology</option>
                                    <option value="computer-science">Computer Science</option>
                                    <option value="engineering">Engineering</option>
                                    <option value="business">Business</option>
                                    <option value="arts">Arts & Humanities</option>
                                    <option value="language">Languages</option>
                                    <option value="social-sciences">Social Sciences</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Price Range -->
                        <div class="filter-group">
                            <h5>Price Range</h5>
                            <div class="price-slider">
                                <div id="priceRangeSlider" class="multi-range-slider"></div>
                                <div class="slider-labels mt-2">
                                    <div>$<span id="minPriceValue">0</span></div>
                                    <div>$<span id="maxPriceValue">300</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Condition Filter -->
                        <div class="filter-group">
                            <h5>Condition</h5>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-condition" type="checkbox" value="new" id="conditionNew" checked>
                                <label class="form-check-label" for="conditionNew">New</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-condition" type="checkbox" value="like-new" id="conditionLikeNew" checked>
                                <label class="form-check-label" for="conditionLikeNew">Like New</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-condition" type="checkbox" value="good" id="conditionGood" checked>
                                <label class="form-check-label" for="conditionGood">Good</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-condition" type="checkbox" value="fair" id="conditionFair" checked>
                                <label class="form-check-label" for="conditionFair">Fair</label>
                            </div>
                        </div>
                        
                        <!-- Location Filter -->
                        <div class="filter-group">
                            <h5>Location</h5>
                            <div class="mb-3">
                                <input type="text" class="form-control" id="locationFilter" placeholder="Search by location...">
                            </div>
                        </div>
                        
                        <!-- Book-specific Filters -->
                        <div class="filter-group">
                            <h5>Book Details</h5>
                            <div class="mb-3">
                                <input type="text" class="form-control mb-2" id="authorFilter" placeholder="Author name...">
                                <input type="text" class="form-control mb-2" id="isbnFilter" placeholder="ISBN...">
                                <select class="form-select" id="publicationYearFilter">
                                    <option value="all">All Publication Years</option>
                                    <option value="2023">2023</option>
                                    <option value="2022">2022</option>
                                    <option value="2021">2021</option>
                                    <option value="2020">2020</option>
                                    <option value="2019">2019</option>
                                    <option value="2018">2018</option>
                                    <option value="older">2017 and older</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Course-specific Filters -->
                        <div class="filter-group">
                            <h5>Course Details</h5>
                            <div class="mb-3">
                                <input type="text" class="form-control mb-2" id="courseCodeFilter" placeholder="Course code...">
                                <input type="text" class="form-control" id="courseNameFilter" placeholder="Course name...">
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="university-specific" id="universitySpecificFilter">
                                <label class="form-check-label" for="universitySpecificFilter">
                                    University-specific materials only
                                </label>
                            </div>
                        </div>
                        
                        <!-- Apply Filters Button -->
                        <button class="btn btn-primary w-100 mt-3" id="applyFiltersBtn">
                            <i class="fas fa-filter me-2"></i> Apply Filters
                        </button>
                        
                        <!-- Clear Filters Button -->
                        <button class="btn btn-outline-secondary w-100 mt-2" id="clearFiltersBtn">
                            <i class="fas fa-times me-2"></i> Clear Filters
                        </button>
                    </div>
                </div>
                
                <div class="col-md-8">
                    <!-- Search Results -->
                    <div class="search-results-container">
                        <!-- Applied Filters -->
                        <div class="applied-filters mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h4 class="mb-0">Search Results <span id="resultCount">(10)</span></h4>
                                <div class="sort-dropdown">
                                    <button class="btn btn-outline-secondary dropdown-toggle" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-sort me-1"></i> Sort By: Newest
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="sortDropdown">
                                        <li><a class="dropdown-item sort-option active" href="#" data-sort="newest">Newest First</a></li>
                                        <li><a class="dropdown-item sort-option" href="#" data-sort="oldest">Oldest First</a></li>
                                        <li><a class="dropdown-item sort-option" href="#" data-sort="price-low">Price Low to High</a></li>
                                        <li><a class="dropdown-item sort-option" href="#" data-sort="price-high">Price High to Low</a></li>
                                        <li><a class="dropdown-item sort-option" href="#" data-sort="relevance">Relevance</a></li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Search Filters Tags -->
                            <div class="search-filters mt-3">
                                <div class="filter-tag">
                                    Textbooks <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="filter-tag">
                                    Price: $0 - $100 <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="filter-tag">
                                    Condition: New <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="filter-tag">
                                    Mathematics <i class="fas fa-times-circle"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Results Grid -->
                        <div class="row" id="searchResults">
                            <!-- Product cards will be dynamically added here -->
                        </div>
                        
                        <!-- Pagination -->
                        <nav aria-label="Search results pagination" class="mt-4">
                            <ul class="pagination justify-content-center">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Section -->
    <footer class="bg-dark text-white py-4 mt-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5>StudyXchange</h5>
                    <p>The best platform for students to buy, sell, and exchange study materials.</p>
                </div>
                <div class="col-md-2 mb-3">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="../index.html" class="text-white">Home</a></li>
                        <li><a href="category.html" class="text-white">Categories</a></li>
                        <li><a href="post-ad.html" class="text-white">Post Ad</a></li>
                        <li><a href="profile.html" class="text-white">My Account</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-3">
                    <h5>Popular Categories</h5>
                    <ul class="list-unstyled">
                        <li><a href="category.html?category=textbooks" class="text-white">Textbooks</a></li>
                        <li><a href="category.html?category=notes" class="text-white">Notes</a></li>
                        <li><a href="category.html?category=electronics" class="text-white">Electronics</a></li>
                        <li><a href="category.html?category=courses" class="text-white">Course Materials</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-3">
                    <h5>Contact Us</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope me-2"></i> support@studyxchange.com</li>
                        <li><i class="fas fa-phone me-2"></i> +1 234 567 8900</li>
                        <li class="mt-3">
                            <a href="#" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="text-white me-2"><i class="fab fa-twitter"></i></a>
                            <a href="#" class="text-white me-2"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="text-white me-2"><i class="fab fa-linkedin-in"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <p>&copy; 2023 StudyXchange. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- NoUiSlider JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.6.0/nouislider.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="../js/data.js"></script>
    <script src="../js/search.js"></script>
    <script src="../js/favorites.js"></script>
    <script src="../js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize price range slider
            const priceRangeSlider = document.getElementById('priceRangeSlider');
            
            if (priceRangeSlider) {
                // Create the noUiSlider
                noUiSlider.create(priceRangeSlider, {
                    start: [0, 300],
                    connect: true,
                    step: 5,
                    range: {
                        'min': 0,
                        'max': 300
                    },
                    format: {
                        to: function (value) {
                            return Math.round(value);
                        },
                        from: function (value) {
                            return Math.round(value);
                        }
                    }
                });
                
                // Update the price values when the slider changes
                priceRangeSlider.noUiSlider.on('update', function(values) {
                    const minPrice = document.getElementById('minPriceValue');
                    const maxPrice = document.getElementById('maxPriceValue');
                    
                    if (minPrice && maxPrice) {
                        minPrice.textContent = values[0];
                        maxPrice.textContent = values[1];
                    }
                });
            }
            
            // Load search results
            loadSearchResults();
            
            // Filter tag removal
            const filterTags = document.querySelectorAll('.filter-tag');
            filterTags.forEach(tag => {
                const removeIcon = tag.querySelector('i');
                if (removeIcon) {
                    removeIcon.addEventListener('click', function() {
                        tag.remove();
                        loadSearchResults(); // Reload results without this filter
                    });
                }
            });
            
            // Apply filters button
            const applyFiltersBtn = document.getElementById('applyFiltersBtn');
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', function() {
                    loadSearchResults();
                });
            }
            
            // Clear filters button
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');
            if (clearFiltersBtn) {
                clearFiltersBtn.addEventListener('click', function() {
                    // Reset all checkboxes
                    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                        checkbox.checked = true;
                    });
                    
                    // Reset all text inputs
                    document.querySelectorAll('input[type="text"]').forEach(input => {
                        input.value = '';
                    });
                    
                    // Reset all selects
                    document.querySelectorAll('select').forEach(select => {
                        select.value = 'all';
                    });
                    
                    // Reset price range slider
                    if (priceRangeSlider && priceRangeSlider.noUiSlider) {
                        priceRangeSlider.noUiSlider.set([0, 300]);
                    }
                    
                    // Clear filter tags
                    document.querySelectorAll('.filter-tag').forEach(tag => {
                        tag.remove();
                    });
                    
                    // Reload results
                    loadSearchResults();
                });
            }
            
            // Sort options
            const sortOptions = document.querySelectorAll('.sort-option');
            sortOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all options
                    sortOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // Add active class to clicked option
                    this.classList.add('active');
                    
                    // Update dropdown text
                    const sortText = {
                        'newest': 'Newest First',
                        'oldest': 'Oldest First',
                        'price-low': 'Price Low to High',
                        'price-high': 'Price High to Low',
                        'relevance': 'Relevance'
                    };
                    
                    const sortDropdown = document.getElementById('sortDropdown');
                    if (sortDropdown) {
                        sortDropdown.innerHTML = `<i class="fas fa-sort me-1"></i> Sort By: ${sortText[this.dataset.sort]}`;
                    }
                    
                    // Sort and reload results
                    loadSearchResults(this.dataset.sort);
                });
            });
            
            // Pagination event listeners
            const paginationLinks = document.querySelectorAll('.pagination .page-link');
            paginationLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Only process if not disabled
                    if (!this.parentNode.classList.contains('disabled')) {
                        // Update active page
                        document.querySelector('.pagination .active').classList.remove('active');
                        this.parentNode.classList.add('active');
                        
                        // Reload results for the new page
                        loadSearchResults();
                    }
                });
            });
        });
        
        // Function to load search results based on filters
        function loadSearchResults(sortOption = 'newest') {
            const searchResultsContainer = document.getElementById('searchResults');
            if (!searchResultsContainer) return;
            
            // Clear container
            searchResultsContainer.innerHTML = '';
            
            // Get filtered products (using the existing filterProducts function)
            let filteredProducts = filterProducts();
            
            // Apply advanced filters (would normally be done on the server)
            const authorFilter = document.getElementById('authorFilter').value.toLowerCase();
            const isbnFilter = document.getElementById('isbnFilter').value.toLowerCase();
            const publicationYearFilter = document.getElementById('publicationYearFilter').value;
            const courseCodeFilter = document.getElementById('courseCodeFilter').value.toLowerCase();
            const courseNameFilter = document.getElementById('courseNameFilter').value.toLowerCase();
            const universitySpecificFilter = document.getElementById('universitySpecificFilter').checked;
            
            if (authorFilter || isbnFilter || publicationYearFilter !== 'all' || 
                courseCodeFilter || courseNameFilter || universitySpecificFilter) {
                // This is a simplification since our mock data doesn't have all these fields
                filteredProducts = filteredProducts.filter(product => {
                    // For demonstration, we'll just filter by title containing these terms
                    return product.title.toLowerCase().includes(authorFilter) &&
                           product.title.toLowerCase().includes(isbnFilter) &&
                           product.title.toLowerCase().includes(courseCodeFilter) &&
                           product.title.toLowerCase().includes(courseNameFilter);
                });
            }
            
            // Sort products
            switch (sortOption) {
                case 'newest':
                    filteredProducts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
                case 'oldest':
                    filteredProducts.sort((a, b) => new Date(a.date) - new Date(b.date));
                    break;
                case 'price-low':
                    filteredProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'relevance':
                    // For relevance, we'd normally score based on search term matches
                    // Here we'll just use the default ordering
                    break;
            }
            
            // Update result count
            const resultCount = document.getElementById('resultCount');
            if (resultCount) {
                resultCount.textContent = `(${filteredProducts.length})`;
            }
            
            // Check if there are any products to display
            if (filteredProducts.length === 0) {
                searchResultsContainer.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No products found</h3>
                            <p>Try adjusting your filters or search terms.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Display the products
            filteredProducts.forEach(product => {
                const isFavorite = isProductInFavorites(product.id);
                const productCard = createProductCard(product, isFavorite);
                searchResultsContainer.appendChild(productCard);
            });
        }
    </script>
</body>
</html>